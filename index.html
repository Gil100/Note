<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אפליקציית רישום הערות</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        #create-note {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        #notes-container {
            margin-top: 20px;
        }
        .note {
            background-color: white;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .note-date {
            font-size: 0.8em;
            color: #666;
        }
        .note-content {
            margin-top: 5px;
        }
        .note-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }
        .note-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-left: 5px;
            cursor: pointer;
        }
        .delete-note {
            background-color: #f44336;
        }
        .reminder-note {
            background-color: #2196F3;
        }
        .note.done .note-content {
            text-decoration: line-through;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
        }
        #note-text {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
        }
        .modal-buttons {
            text-align: left;
        }
        .modal-button {
            padding: 10px 20px;
            margin-left: 10px;
            cursor: pointer;
        }
        #delete-confirmation .modal-content,
        #reminder-modal .modal-content {
            text-align: center;
        }
        #delete-confirmation .modal-buttons,
        #reminder-modal .modal-buttons {
            text-align: center;
            margin-top: 20px;
        }
        #delete-confirmation .modal-button,
        #reminder-modal .modal-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
        }
        #reminder-datetime {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>אפליקציית רישום הערות</h1>
    <button id="create-note">יצירת הערה חדשה</button>
    <div id="notes-container"></div>

    <div id="note-modal" class="modal">
        <div class="modal-content">
            <textarea id="note-text" placeholder="הכנס את ההערה שלך כאן"></textarea>
            <div class="modal-buttons">
                <button id="save-note" class="modal-button">שמור</button>
                <button id="cancel-note" class="modal-button">ביטול</button>
            </div>
        </div>
    </div>

    <div id="delete-confirmation" class="modal">
        <div class="modal-content">
            <p>Delete this note?</p>
            <div class="modal-buttons">
                <button id="confirm-delete" class="modal-button">Yes</button>
                <button id="cancel-delete" class="modal-button">No</button>
            </div>
        </div>
    </div>

    <div id="reminder-modal" class="modal">
        <div class="modal-content">
            <h2>הגדר תזכורת</h2>
            <input type="datetime-local" id="reminder-datetime">
            <div class="modal-buttons">
                <button id="save-reminder" class="modal-button">שמור</button>
                <button id="cancel-reminder" class="modal-button">ביטול</button>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            let editingNoteId = null;
            let notes = [];

            function saveNotes() {
                localStorage.setItem('notes', JSON.stringify(notes));
            }

            function loadNotes() {
                const savedNotes = localStorage.getItem('notes');
                if (savedNotes) {
                    notes = JSON.parse(savedNotes);
                    renderNotes();
                }
            }

            function renderNotes() {
                $("#notes-container").empty();
                notes.forEach(function(note) {
                    const noteHtml = createNoteHtml(note);
                    $("#notes-container").append(noteHtml);
                });
            }

            function createNoteHtml(note) {
                const reminderIcon = note.reminder ? '<i class="fas fa-bell" style="color: #2196F3;"></i>' : '';
                return `
                    <div id="${note.id}" class="note ${note.done ? 'done' : ''}">
                        <div class="note-header">
                            <span class="note-date">${note.date} ${reminderIcon}</span>
                            <label><input type="checkbox" class="note-done" ${note.done ? 'checked' : ''}> בוצע</label>
                        </div>
                        <div class="note-content">${note.content}</div>
                        <div class="note-actions">
                            <button class="note-button reminder-note"><i class="fas fa-bell"></i></button>
                            <button class="note-button edit-note">ערוך</button>
                            <button class="note-button delete-note">מחק</button>
                        </div>
                    </div>
                `;
            }

            loadNotes();

            $("#create-note").click(function() {
                editingNoteId = null;
                $("#note-text").val("");
                $("#note-modal").show();
            });

            $("#cancel-note").click(function() {
                $("#note-modal").hide();
                $("#note-text").val("");
            });

            $("#save-note").click(function() {
                const noteText = $("#note-text").val().trim();
                if (noteText) {
                    const now = new Date();
                    const noteDate = now.toLocaleDateString('he-IL') + ' ' + now.toLocaleTimeString('he-IL');
                    if (editingNoteId) {
                        const noteIndex = notes.findIndex(note => note.id === editingNoteId);
                        if (noteIndex !== -1) {
                            notes[noteIndex].content = noteText;
                            notes[noteIndex].date = noteDate;
                        }
                    } else {
                        const newNote = {
                            id: 'note-' + Date.now(),
                            content: noteText,
                            date: noteDate,
                            done: false,
                            reminder: null
                        };
                        notes.push(newNote);
                    }
                    saveNotes();
                    renderNotes();
                    $("#note-modal").hide();
                    $("#note-text").val("");
                    editingNoteId = null;
                }
            });

            $(document).on("change", ".note-done", function() {
                const noteId = $(this).closest(".note").attr('id');
                const noteIndex = notes.findIndex(note => note.id === noteId);
                if (noteIndex !== -1) {
                    notes[noteIndex].done = $(this).is(":checked");
                    saveNotes();
                }
                $(this).closest(".note").toggleClass("done");
            });

            $(document).on("click", ".edit-note", function() {
                const noteElement = $(this).closest(".note");
                editingNoteId = noteElement.attr('id');
                const noteIndex = notes.findIndex(note => note.id === editingNoteId);
                if (noteIndex !== -1) {
                    $("#note-text").val(notes[noteIndex].content);
                    $("#note-modal").show();
                }
            });

            let noteToDelete = null;

            $(document).on("click", ".delete-note", function() {
                noteToDelete = $(this).closest(".note").attr('id');
                $("#delete-confirmation").show();
            });

            $("#confirm-delete").click(function() {
                if (noteToDelete) {
                    notes = notes.filter(note => note.id !== noteToDelete);
                    saveNotes();
                    renderNotes();
                    noteToDelete = null;
                }
                $("#delete-confirmation").hide();
            });

            $("#cancel-delete").click(function() {
                noteToDelete = null;
                $("#delete-confirmation").hide();
            });

            let reminderNoteId = null;

            $(document).on("click", ".reminder-note", function() {
                reminderNoteId = $(this).closest(".note").attr('id');
                $("#reminder-modal").show();
            });

            $("#save-reminder").click(function() {
                const reminderDateTime = $("#reminder-datetime").val();
                if (reminderDateTime && reminderNoteId) {
                    const noteIndex = notes.findIndex(note => note.id === reminderNoteId);
                    if (noteIndex !== -1) {
                        notes[noteIndex].reminder = reminderDateTime;
                        saveNotes();
                        renderNotes();
                        setReminder(notes[noteIndex]);
                    }
                }
                $("#reminder-modal").hide();
            });

            $("#cancel-reminder").click(function() {
                $("#reminder-modal").hide();
            });

            function setReminder(note) {
                const now = moment();
                const reminderTime = moment(note.reminder);
                const timeUntilReminder = reminderTime.diff(now);
                
                if (timeUntilReminder > 0) {
                    setTimeout(() => {
                        alert(`תזכורת: ${note.content}`);
                    }, timeUntilReminder);
                }
            }

            // Set reminders for existing notes
            notes.forEach(note => {
                if (note.reminder) {
                    setReminder(note);
                }
            });
        });
    </script>
</body>
</html>
